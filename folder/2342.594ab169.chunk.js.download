"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[2342],{42342:(e,t,n)=>{n.d(t,{Em:()=>G,Py:()=>V,b8:()=>Q});n(5086),n(17),n(58379),n(7899),n(59581),n(80115),n(14913),n(80475),n(68329),n(87136),n(40173),n(69193),n(41412),n(6048),n(34606),n(18665),n(7918),n(29979),n(79404),n(39982),n(57399),n(86970),n(11048),n(2236),n(71650),n(26884),n(58710),n(63617),n(83019),n(98657),n(53380),n(14602),n(36611),n(87787),n(63534),n(40590),n(94009),n(12091),n(10678),n(3101),n(64216),n(98741),n(15195);var r=n(76157),o=n(56184),i=n.n(o),s=n(24859),a=n(82951),c=n(54183),u=n(51363),l=n(27291),f=n(37968),d=n(63720),p=n(65693),h=n(62886),y=n(67791),v=n(81160),A=n(16126),g=n(65490),_=n(7711),C=n(87037),E=n(77298),S=n(5578);function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,a=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){x(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function x(e,t,n){return(t=D(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(){return k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=z(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},k.apply(null,arguments)}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,D(r.key),r)}}function w(e,t,n){return t&&R(e.prototype,t),n&&R(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function D(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t,n){return t=z(t),j(e,$()?Reflect.construct(t,n||[],z(e).constructor):t.apply(e,n))}function j(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function M(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&H(e,t)}function I(e){var t="function"==typeof Map?new Map:void 0;return I=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if($())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var o=new(e.bind.apply(e,r));return n&&H(o,n.prototype),o}(e,arguments,z(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),H(n,e)},I(e)}function $(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return($=function(){return!!e})()}function H(e,t){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},H(e,t)}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}var U=(0,r.getLogger)("AEFCAMSSearchUtil"),q=(0,r.getLogger)("CAMSRMQMessageHandler"),L={NONE:"NONE",DESC:"DESC",ASC:"ASC"},B={initAssets:"",updateAssets:"",updateAssetProperties:"",removeAsset:"",updateAssetsCount:"",addContainerResources:"",mergeContainerResourcesWithAssets:""},F=function(e){function t(){return P(this,t),N(this,t,arguments)}return M(t,e),w(t)}(I(Error)),V=function(e){function t(e){var n;P(this,t);var r=n=N(this,t,[t]);return n._construct(e),j(n,r)}return M(t,e),w(t,[{key:"_validateContainerDetailsContext",value:function(e){if(!e)throw new Error("No container details context provided!");if(!i()(e,"container",i()(e,"space",i()(e,"project"))))throw new Error("No container provided on container details context!");return!0}},{key:"_validateReduxActions",value:function(e){if(!e)throw new Error("Redux actions are required!");for(var t in B)if((0,u.x)(B,t)&&!(0,u.x)(e,t))throw new Error("Redux action not found: "+t)}},{key:"_validateOptions",value:function(e){if(!e)throw new Error("No options provided");if(!Array.isArray(e.rawExtensions))throw new Error("No extensions passed in");this._validateContainerDetailsContext(e.containerDetailsContext),this._validateReduxActions(e.reduxActions)}},{key:"_construct",value:function(e){if(function(e,t,n,r){var o=k(z(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof o?function(e){return o.apply(n,e)}:o}(t,"shouldConstruct",this,3)([])&&e){this.intl=e.intl,this.reduxActions=e.reduxActions,this.containerDetailsContext=e.containerDetailsContext,this.appContext=e.appContext,this.dapErrorModalContext=e.dapErrorModalContext,this.rawExtensions=e.rawExtensions,this.bookmarks=[""],this.previousPage=1,this.reloadHandlers=[],this.containerResourceConfigurations={};try{this._validateOptions(e)}catch(n){U.error("Error setting up AEF Cams util: "+n.message)}if(!this._isCAMSSupportedContainer())throw new F("Container is not CAMS supported.")}}},{key:"containerType",get:function(){return this.containerDetailsContext.containerType||_.krw}},{key:"containerId",get:function(){return i()(this.container,"metadata.".concat(this.containerType===_.krw?"id":"guid"))}},{key:"container",get:function(){var e=this.containerDetailsContext;return i()(e,"container",i()(e,this.containerType))}},{key:"init",value:function(){this.extensionInstance=new s.K8({rawExtensions:this.rawExtensions,intl:this.intl,contexts:{appContext:this.appContext,containerDetailsContext:this.containerDetailsContext}}),this.hasReceivedCounts=!1,this.initializeContainerResources(),this.initializeRedux(),this.loadContainerResources("beginning"),this.reload$=new l.B}},{key:"addReloadHandler",value:function(e){Array.isArray(this.reloadHandlers)&&this.reloadHandlers.push(e)}},{key:"_isCAMSSupportedContainer",value:function(){return!0}},{key:"initializeContainerResources",value:function(){var e=this,t=this.extensionInstance.getAllAvailableAssetExtensions().filter(function(e){return i()(e,"details.options.asset_resources")}).reduce(function(t,n){var r=i()(n,"details.options.asset_resources"),o=i()(n,"details.actions",{});return Object.keys(r).forEach(function(c){var u,l,f=r[c];if(f.fetch_action_id&&o[f.fetch_action_id]&&(u=o[f.fetch_action_id],l=new a.tC(u,{contexts:e})),u)if(u.type===s.Ns.actionTypes.HTTPRequestAction)if(l.doesApply()){var d=i()(n,"details.asset_type");t[c]?t[c]._dependantAssetTypes.push(d):(t[c]=r[c],t[c]._fetchAction=u,t[c]._assetResource=c,t[c]._dependantAssetTypes=[d],t[c]._loaded=!1,t[c]._containerResource=c,t[c]._assetType=d)}else U.warn("Action provided for asset_resources ( ".concat(c," ) ")+"does not apply for the given context. Skipping.");else U.warn("Action provided for asset_resources ( ".concat(c," ) ")+"is not an HTTPRequestAction. Skipping.");else U.warn("Could not find fetch action for asset_resources ( ".concat(c," ). + Skipping."))}),t},{});this.containerResourceConfigurations=t}},{key:"initializeRedux",value:function(){this.hasReceivedCounts=!1,this.initializeAssetsRedux(),this.initializeContainerResourcesRedux()}},{key:"initializeAssetsRedux",value:function(){var e=this.extensionInstance.getAllAvailableAssetCategoriesAndType(),t=Object.keys(e);this.reduxActions.initAssets(t)}},{key:"initializeContainerResourcesRedux",value:function(){var e=this;Object.keys(this.containerResourceConfigurations).forEach(function(t){return e.reduxActions.addContainerResources(t,[])})}},{key:"loadContainerResources",value:function(e,t,n,r){var o=this;Object.keys(this.containerResourceConfigurations).filter(function(t){return o.containerResourceConfigurations[t].fetch_policy===e}).forEach(function(e){return o.loadContainerResource(e,t,n,r)})}},{key:"loadContainerResource",value:function(e,t,n,r){var o=this,i=this.containerResourceConfigurations[e],a=i.merge_by,c=i._fetchAction,u=i.fetch_policy,l=i._dependantAssetTypes,f=!1;if(("on_load"===u&&r&&l.some(function(e){return r[e]})||!r&&Array.isArray(t)&&1===t.length)&&(f=!0),f){var d={appContext:this.appContext,containerDetailsContext:this.containerDetailsContext,assetsContext:{}},p=Array.isArray(t)?t.map(function(e){var t;return i.property_path?S.s.getPropertyValue(e,i.property_path):null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.asset_id}):null,h=m({},d);p&&(h.selectedAssets=p.reduce(function(e,t){return e[t]=!0,e},{})),new s.Ye(c,{handleHTTPRequestActionResult:function(t){t.ok?t.json().then(function(t){var n=!1;Array.isArray(t)?n=t:t&&t.resources&&Array.isArray(t.resources)&&(n=t.resources),n?(o.reduxActions.addContainerResources(e,n),a&&o.reduxActions.mergeContainerResourcesWithAssets(i,n)):U.error("Unexpected response from container resource fetch. Resources could not be found.")}).catch(function(e){U.error("Received error from request. Error: ".concat(e.message))}):U.error("Fetching the container resource ( ".concat(e," ) failed. Status (").concat(t.status,")"))},contexts:h}).handle({assetIds:p})}}},{key:"reload",value:function(e){this.reload$.next(e);var t=this.reloadHandlers;Array.isArray(t)&&t.filter(function(e){return"function"===typeof e}).forEach(function(t){return t(e)})}},{key:"load",value:function(e){this.containerDetailsContext.isContainerArchived||(U.info("Starting load with options "+JSON.stringify(e,void 0,3)),this._getAssets({reduxState:i()(e,"reduxState",null),category:i()(e,"category",s.Ns.uiCategories.all),assetType:i()(e,"assetType",null),sortColumn:i()(e,"sortColumn",null),sortDirection:i()(e,"sortDirection",null),searchValue:i()(e,"searchValue",null),currentPage:i()(e,"currentPage",null),folder:i()(e,"folder",null),pageSize:i()(e,"pageSize",null),onSuccess:i()(e,"onSuccess",function(){return null}),onError:i()(e,"onError",function(){return null}),foldersEnabled:i()(e,"foldersEnabled",!1)}))}},{key:"updateAssetProperties",value:function(e,t,n){e&&t&&this.reduxActions.updateAssetProperties(e,t,n)}},{key:"updateAsset",value:function(e){var t=this;if(!this.containerDetailsContext.isContainerArchived){var n=this.appContext.userfs,r=this._getContainerId(),o=e.assetId,i=e.category,s=e.assetType;E.p_({assetId:o,spaceId:r,userfs:n}).then(function(n){var r=b(n,1)[0];t.reduxActions.updateAssetProperties(r,i,s),t.loadContainerResources("on_load",[r],e.assetType)}).catch(function(e){var n=b(e,2),r=(n[0],n[1]);C.G(r,t.intl,{logger:t.logger})})}}},{key:"updateCount",value:function(e){var t=this;U.info("Fetching asset count...");var n=i()(e,"onSuccess",function(){return null}),r=i()(e,"onError",function(){return null}),o=null===e||void 0===e?void 0:e.foldersEnabled,s=this._getContainerId();E.GU({spaceId:s,counts:["asset.asset_type"],trueCount:!0,countOnly:!0,foldersEnabled:o}).then(function(e){var r=b(e,1)[0];t.reduxActions.updateAssetsCount({counts:r.counts,processedCounts:t._processCounts(r.counts)}),t.hasReceivedCounts=!0,n()}).catch(function(e){U.error("Something went wrong searchingAssets to update count. Error: ".concat(JSON.stringify(e))),r()})}},{key:"removeAsset",value:function(e,t,n){this.reduxActions.removeAsset(e,t,n)}},{key:"addAsset",value:function(e,t,n){this.reduxActions.addAsset(e,t,n)}},{key:"_getAssets",value:function(e){var t=this,n=i()(e,"onSuccess",function(){return null}),r=i()(e,"onError",function(){return null}),o=null===e||void 0===e?void 0:e.foldersEnabled,s=e.category,a=e.assetType,c=e.currentPage,u=this._getCAMSSearchOptions(e);this.reduxActions.updateAssets({loading:!0},s,a),this.hasReceivedCounts||this.updateCount({onSuccess:function(){return 0},onError:function(){return 0},foldersEnabled:o}),E.GU(u.request).then(function(e){var r=b(e,1)[0];t.previousPage===c&&(t.bookmarks=t.bookmarks.slice(0,c)),t.bookmarks[c]=r.bookmark,t.previousPage=c;var o=t._processCounts(r.counts);t.loadContainerResources("on_load",r.results,a,null===o||void 0===o?void 0:o.assetTypeAndCounts),U.debug("Received ".concat(r.results.length," assets. CATEGORY: ").concat(s," ASSET_TYPE: ").concat(a)),t.reduxActions.updateAssets({loading:!1,data:{results:r.results,counts:r.counts||null,loadedPages:t.bookmarks.length,processedCounts:t._processCounts(r.counts)}},s,a),n(r.total)}).catch(function(e){var n=e.error instanceof Error?e.error:new Error("Failed to load assets.");t.reduxActions.updateAssets({loading:!1,error:n.message},s,a),C.G(e.result,t.intl,{logger:t.logger,onCodeClick:function(){return t.dapErrorModalContext.openDapErrorModal(e.result)}}),r(e)})}},{key:"_processCounts",value:function(e){var t=e&&e["asset.asset_type"],n=this.extensionInstance.getAllAvailableAssetCategoriesAndType({includeAll:!0}),r=Object.keys(n).reduce(function(e,r){var o=n[r];return e[r]=o.filter(function(e){return e}).map(function(e){return i()(t,e,0)}).reduce(function(e,t){return e+t},0),e},{}),o=Object.keys(n).reduce(function(e,r){var o=n[r];return e[r]=o.filter(function(e){return e}).reduce(function(e,n){return e[n]=i()(t,n,0),e},{}),e},{});return{assetCategoriesAndCount:r,assetTypeAndCounts:t,categoryAssetTypeCountMap:o}}},{key:"_getCAMSSearchOptions",value:function(e){var n=e.pageSize||100,r=this._getCAMSSearchQueryByAssetCategory(e),o=t.defaultSort,i=e.sortColumn,a=e.sortDirection;if(i&&s.Ns.columnSort[i]){var c=a===L.DESC?"-":"";o="".concat(c).concat(s.Ns.columnSort[i]),c===L.NONE&&(o=null)}return{request:{spaceId:this._getContainerId(),query:r,sort:o,include:"entity",assetType:"asset",limit:n,counts:["asset.asset_type"],trueCount:!0,countOnly:!1,bookmark:this.bookmarks[e.currentPage-1]},behaviour:{}}}},{key:"_getContainerId",value:function(){return i()(this.container,"metadata.id")}},{key:"_getCAMSFolderQuerySelection",value:function(e,t){var n=this.containerDetailsContext.container;return i()(n,"entity.settings.folders.enabled",!1)?e?"".concat(t," AND ").concat(_.Ez2,".path:").concat(e):""===e?"".concat(t," AND ").concat(_.Ez2,".path:empty"):void 0:"NOT asset.asset_type:".concat(_.Ez2)}},{key:"_getCAMSSearchQueryByAssetCategory",value:function(e){var n,r=e.category,o=e.assetType,a=e.searchValue,c=this._getContainerId(),u=e.folder,l="asset.space_id:".concat(c);if(o){var f="(".concat(o,")");n="(".concat(l," AND asset.asset_type:").concat(f,")")}else if(r===s.Ns.uiCategories.all){var d=this.extensionInstance.getAllAvailableAssetTypes().join(" OR "),p="(".concat(d,")");n="(".concat(l," AND asset.asset_type:").concat(p,")")}else{var h=this.extensionInstance.getAllAvailableAssetCategoriesAndType()[r],y=h.some(function(e){return e===_.jLW}),v=h.some(function(e){return e===_.F1J}),A=h.filter(function(e){return e!==_.F1J}).join(" OR "),g="(".concat(A,")");n=y?"(".concat(l," AND (asset.asset_type:").concat(g)+" OR asset.asset_type:data_flow) NOT (asset.owner_id:iam-ServiceId*))":v?h.length>1?"(".concat(l," ")+"AND (wml_training_definition.definition_type:federated_learning "+"OR asset.asset_type:".concat(g,"))"):"(".concat(l," AND wml_training_definition.definition_type:federated_learning)"):"(".concat(l," AND asset.asset_type:").concat(g,")")}var C=this._getCAMSFolderQuerySelection(u,l);if(C&&(n+=" AND ".concat(C)),i()(this.appContext,"isCloud")&&(n+=" AND NOT (asset.name:BM_COS_EDITOR_".concat(c,")")+" AND NOT (asset.name:BM_COS_VIEWER_".concat(c,")")),n+=" AND NOT asset.asset_category:SYSTEM",a){var E=this.appContext.userfs,S=t.processSearchValue(a,{spacesNotEscaped:E}),b=t.regexAgainstNameSearchValue(S),T='"'.concat(S,'*" OR "').concat(S,'"');E||(T+=" OR ".concat(b)),n="(".concat(T,") AND (").concat(n,")")}return n}}],[{key:"defaultSort",get:function(){return"-".concat(s.Ns.columnSort.asset_modified_column)}},{key:"processSearchValue",value:function(e){var t=e;return 0===(t=t.trim()).indexOf("*")&&(t=t.substring(1,t.length)),t=t.replace(/[+\-&|!(){}[\]^"~*?:\\/ ]/g,"\\$&")}},{key:"regexAgainstNameSearchValue",value:function(e){return"asset.name:/.*".concat(e,"+.*/")}}])}(c.K),Q={CREATE_ASSET:"CREATE_ASSET",UPDATE_ASSET:"UPDATE_ASSET",TRASH_ASSET:"TRASH_ASSET",UPDATE_ATTACHMENT:"UPDATE_ATTACHMENT",CREATE_DATA_ASSET:"CREATE_DATA_ASSET",PROMOTE_ASSET:"PROMOTE_ASSET",UPDATE_PROMOTED_ASSET:"UPDATE_PROMOTED_ASSET",IMPORT_ASSET:"IMPORT_ASSET",IMPORT_ASSET_UPDATE:"IMPORT_ASSET_UPDATE",CANCEL_IMPORT_ASSET:"CANCEL_IMPORT_ASSET"},G=function(e){function t(e){var n;P(this,t);var r=n=N(this,t,[t]);return e?n._validateOptions(e)?(n._construct(n._defaultOptions(e)),j(n,r)):(n.Class=null,j(n,r)):j(n,r)}return M(t,e),w(t,[{key:"_validateOptions",value:function(e){return!!e&&("function"===typeof e.reload&&!(!e.containerId||!e.requestToken||"string"!==typeof e.requestToken))}},{key:"_defaultOptions",value:function(e){return m(m({},{path:_.y1m,errorHandler:function(){return 0}}),e)}},{key:"_construct",value:function(e){this.options=e,this.enabled=!1,this.manualEvent$=new l.B,this.initializeSocket(e)}},{key:"triggerEvent",value:function(e){this.manualEvent$&&this.manualEvent$.next(m({actor:{iam_id:this.options.iamId}},e))}},{key:"_getSocket",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(t){return(0,g.init)({path:e.path,request_token:e.requestToken},t)})}},{key:"initializeSocket",value:function(e){var t=this;this.socket$=(0,f.H)(this._getSocket(e)),this.disconnect$=this.socket$.pipe((0,d.n)(function(e){return(0,p.R)(e,"disconnect")})),this.errors$=this.socket$.pipe((0,d.n)(function(e){return(0,h.h)((0,p.R)(e,"connect_error"),(0,p.R)(e,"reconnect_failed"),(0,p.R)(e,"error")).pipe((0,y.Q)(t.disconnect$))})).subscribe(function(n){t.enabled=!1,e.errorHandler(n)});var n=function(e){var t=e&&e.event,n=JSON.stringify(e,void 0,2);return Q[t]?(q.info(n),m(m({},e),{},{assetId:i()(e,"details.asset_id"),assetType:i()(e,"details.asset_type"),assetName:i()(e,"details.asset_name"),actor:i()(e,"actor"),event:t})):(q.info("Unsupported message. No associated handler for message ( ".concat(n," )")),null)};this.events$=this.socket$.pipe((0,d.n)(function(e){return(0,h.h)((0,p.R)(e,"cams-event").pipe((0,v.T)(n)),t.manualEvent$)}),(0,y.Q)(this.disconnect$),(0,A.p)(function(e){return e&&e.event&&Q[e.event]})),this.socket$.subscribe(function(n){var r=e.containerId;t.enabled=!0,n.emit("join-room","".concat("spaces.v2.cams",".").concat(r))}),this.events$.subscribe(e.reload)}}],[{key:"events",get:function(){return Q}}])}(c.K)}}]);